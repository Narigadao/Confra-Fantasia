<!DOCTYPE html>
<html>
<head>
    <title>Vota√ß√£o - Confraterniza√ß√£o</title>
    <style>
        body { background: #141414; color: white; font-family: Arial; 
               display: flex; flex-direction: column; align-items: center; 
               justify-content: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { max-width: 600px; width: 100%; }
        .fantasia { background: #333; margin: 10px; padding: 20px; 
                    border-radius: 10px; cursor: pointer; text-align: center;
                    transition: all 0.3s; border: 2px solid transparent; }
        .fantasia:hover { background: #444; border-color: #E50914; transform: scale(1.02); }
        h1 { color: #E50914; margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó≥Ô∏è Vote na Melhor Fantasia</h1>
        <div id="listaFantasias">Carregando fantasias...</div>
    </div>

    <script>
    const BIN_ID = "69174fdd43b1c97be9ad6212";
    const API_KEY = "$2a$10$JApmGfSiV9tlvLo0nOIFX.iVHlXtOO760ew/5wXcp5r78pKsUc5NC";

    async function carregarFantasias() {
        try {
            const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                headers: { 'X-Master-Key': API_KEY }
            });
            const data = await response.json();
            
            const container = document.getElementById('listaFantasias');
            
            if (!data.record.inscricoes || data.record.inscricoes.length === 0) {
                container.innerHTML = '<p>Nenhuma fantasia inscrita ainda.</p>';
                return;
            }
            
            container.innerHTML = '<h3>Clique em uma fantasia para votar:</h3>';
            
            data.record.inscricoes.forEach(inscricao => {
                const div = document.createElement('div');
                div.className = 'fantasia';
                div.innerHTML = `
                    <div style="font-size: 20px; font-weight: bold; margin-bottom: 5px;">
                        ${inscricao.fantasia}
                    </div>
                    <div style="color: #ccc; font-size: 14px;">
                        por ${inscricao.nome}
                    </div>
                `;
                div.onclick = () => votar(inscricao.fantasia);
                container.appendChild(div);
            });
            
        } catch (error) {
            console.error('Erro:', error);
            document.getElementById('listaFantasias').innerHTML = '‚ùå Erro ao carregar fantasias.';
        }
    }

    async function votar(fantasia) {
        if (!confirm(`Tem certeza que quer votar em "${fantasia}"?`)) return;
        
        try {
            // Pega dados atuais
            const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                headers: { 'X-Master-Key': API_KEY }
            });
            const data = await response.json();
            
            // Inicializa votos se n√£o existir
            if (!data.record.votos) {
                data.record.votos = {};
            }
            
            // Adiciona voto
            data.record.votos[fantasia] = (data.record.votos[fantasia] || 0) + 1;
            
            // Atualiza
            const updateResponse = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Master-Key': API_KEY
                },
                body: JSON.stringify(data.record)
            });
            
            if (updateResponse.ok) {
                alert(`‚úÖ Voto em "${fantasia}" registrado com sucesso!`);
            } else {
                alert('‚ùå Erro ao registrar voto.');
            }
            
        } catch (error) {
            console.error('Erro:', error);
            alert('‚ùå Erro ao votar. Tente novamente.');
        }
    }

    carregarFantasias();
    </script>
</body>
</html>
