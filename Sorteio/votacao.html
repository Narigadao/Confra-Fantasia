<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Vota√ß√£o de Fantasias</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Vote na Melhor Fantasia üèÜ</h1>
    <div id="lista"></div>
    <button id="btnResultado">Ver Resultado</button>
    <button id="btnSorteio">Fazer Sorteio üé≤</button>
    <button id="btnExportar">Exportar CSV</button>
    <button id="btnReset">Resetar Tudo</button>
    <div id="resultado"></div>
    <div id="ponteiro"></div>
    <div id="roleta"></div>
  </div>

  <script>
    const lista = document.getElementById('lista');
    let inscricoes = JSON.parse(localStorage.getItem('inscricoes') || '[]');

    function renderLista() {
      lista.innerHTML = "";
      if (inscricoes.length === 0) {
        lista.innerHTML = "<p>Nenhuma inscri√ß√£o registrada ainda.</p>";
        return;
      }
      inscricoes.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${item.nome}</h3>
          <p>${item.fantasia}</p>
          <button onclick="votar(${index})">Votar</button>
        `;
        lista.appendChild(card);
      });
    }

    function votar(i) {
      inscricoes[i].votos++;
      localStorage.setItem('inscricoes', JSON.stringify(inscricoes));
      alert(`Voc√™ votou em ${inscricoes[i].fantasia}!`);
    }

    document.getElementById('btnResultado').onclick = function() {
      const ranking = [...inscricoes].sort((a, b) => b.votos - a.votos);
      let html = "<h2>Resultado Parcial</h2>";
      ranking.forEach((item, i) => {
        html += `<p>${i + 1}¬∫ - ${item.fantasia} (${item.votos} votos)</p>`;
      });
      document.getElementById('resultado').innerHTML = html;
    };

    // üé≤ Sorteio com roleta
    document.getElementById('btnSorteio').onclick = function() {
      if (inscricoes.length === 0) return alert("Nenhuma inscri√ß√£o!");
      const roleta = document.getElementById('roleta');
      roleta.style.display = 'block';
      roleta.innerHTML = "";
      let angulo = 0;
      const slice = 360 / inscricoes.length;

      inscricoes.forEach((item, i) => {
        const div = document.createElement('div');
        div.style.position = 'absolute';
        div.style.width = '50%';
        div.style.height = '50%';
        div.style.background = i % 2 === 0 ? '#222' : '#333';
        div.style.color = '#fff';
        div.style.transformOrigin = '100% 100%';
        div.style.transform = `rotate(${i * slice}deg) skewY(${90 - slice}deg)`;
        div.textContent = item.fantasia;
        div.style.fontSize = '12px';
        div.style.paddingTop = '80px';
        roleta.appendChild(div);
      });

      const sorteado = Math.floor(Math.random() * inscricoes.length);
      const giro = 360 * 5 + (360 - sorteado * slice - slice / 2);
      roleta.animate([{ transform: 'rotate(0deg)' }, { transform: `rotate(${giro}deg)` }], {
        duration: 4000,
        easing: 'ease-out'
      });

      setTimeout(() => {
        alert(`üéâ O vencedor do sorteio √©: ${inscricoes[sorteado].nome} com a fantasia "${inscricoes[sorteado].fantasia}"!`);
      }, 4200);
    };

    // üì¶ Exportar CSV
    document.getElementById('btnExportar').onclick = function() {
      if (inscricoes.length === 0) return alert("Nada para exportar!");
      const csv = "Nome,Fantasia,Votos\n" + inscricoes.map(i => `${i.nome},${i.fantasia},${i.votos}`).join("\n");
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = "resultado_fantasias.csv";
      link.click();
    };

    // ‚ôªÔ∏è Resetar Tudo
    document.getElementById('btnReset').onclick = function() {
      if (confirm("Tem certeza que deseja apagar tudo?")) {
        localStorage.removeItem('inscricoes');
        inscricoes = [];
        renderLista();
        document.getElementById('resultado').innerHTML = "";
        alert("Base resetada!");
      }
    };

    renderLista();
  </script>
</body>
</html>
